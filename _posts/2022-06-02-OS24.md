---
title: 王道操作系统笔记-进程（21）-- 内存管理3
date: 2022-06-02 11:55:00 -0500
categories: [笔记]
tags: [操作系统]
pin: false
author: 01

toc: true
comments: true
typora-root-url: ../../Sterben-01.github.io
math: false
mermaid: true

---

# 王道操作系统笔记-内存（21）-- 内存管理3

<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="330" height="86" src="//music.163.com/outchain/player?type=2&amp;id=410446173&amp;auto=1&amp;height=66"> </iframe>

## 内存空间的分配与回收

### 连续分配管理方式

**连续分配指的是为用户进程分配的内存空间必须是连续的。**



#### 单一连续分配

在单一连续分配方式中，内存被分为系统区和用户区。**系统区**通常位于内存的低地址部分，用于存放操作系统相关数据。**用户区**用于存放用户进程相关数据。内存中**只能有一道用户程序**，用户程序独占整个用户区空间。

**优点：**实现简单。无外部碎片。可以采用覆盖技术扩充内存。不一定需要采取内存保护（例：早期的PC操作系统MS-DOS )。

**缺点：**只能用于单用户、单任务的操作系统中。有内部碎片。存储器利用率极低。

**内部碎片指的是分配给某进程的内存区域中，如果有些部分没有用上，就是内部碎片。如下图的蓝色部分就是内部碎片。**

![QQ截图20220602131413](/assets/blog_res/2022-06-02-OS24.assets/QQ%E6%88%AA%E5%9B%BE20220602131413.png)



#### 固定分区分配

将整个用户空间划分为若干个固定大小的分区，在每个分区中只装入一道作业，这样就形成了最早的、最简单的一种可运行多道程序的内存管理方式。

固定分区分配分为**分区大小相等**和**分区大小不等**两种方法。

- 分区大小相等
  - 缺乏灵活性，比如很小的程序会浪费空间，大程序无法装入系统。但是很适合用于用一台计算机控制多个相同对象的场合（比如:钢铁厂有n个相同的炼钢炉，就可把内存分为n个大小相等的区域存放n个炼钢炉控制程序)。
- 分区大小不等
  - 增加了灵活性，可以满足不同大小的进程需求。根据常在系统中运行的作业大小情况进行划分(比如:划分多个小分区、适量中等分区、少量大分区)



![QQ截图20220602131658](/assets/blog_res/2022-06-02-OS24.assets/QQ%E6%88%AA%E5%9B%BE20220602131658.png)



**通常，操作系统需要建立一个数据结构 -- 分区说明表，来实现各个分区的分配与回收。每个表项对应一个分区，通常按分区大小排列。每个表项包括对应分区的大小、起始地址、状态（是否已分配）。**当某用户程序要装入内存时，由操作系统内核程序根据用户程序大小检索该表,从中找到一个能满足大小的、未分配的分区，将之分配给该程序，然后修改状态为“已分配”。

**优点：**实现简单，无外部碎片。

**缺点：**1 .当用户程序太大时，可能所有的分区都不能满足需求，此时不得不采用覆盖技术来解决,但这又会降低性能。2.会产生内部碎片，内存利用率低。



#### 动态分区分配

动态分区分配又称为可变分区分配。这种分配方式不会预先划分内存分区，而是在进程装入内存时，根据进程的大小动态地建立分区，并使分区的大小正好适合进程的需要。因此系统分区的大小和数目是可变的。（eg:假设某计算机内存大小为64MB，系统区8MB，用户区共56 MB….）

1. 系统要用什么样的数据结构记录内存的使用情况?

   - 空闲分区表

     ![QQ截图20220602132254](/assets/blog_res/2022-06-02-OS24.assets/QQ%E6%88%AA%E5%9B%BE20220602132254.png)

   - 空闲分区链

     ![QQ截图20220602132300](/assets/blog_res/2022-06-02-OS24.assets/QQ%E6%88%AA%E5%9B%BE20220602132300.png)




2. 当很多个空闲分区都能满足需求时，应该选择哪个分区进行分配?
   - 使用特定的动态分区分配算法。

   

3. 如何进行分区的分配与回收操作?

   - 如何分配？

     - 删除表项，或 更改空闲分区起始地址（分配出去）

   - 如何回收？
     - 如果回收区的后面有一个相邻的空闲分区，则两个相邻空间合并。
     - 如果回收区的前后都有相邻的空闲分区，则将三个相邻空间合并。
     - 如果回收区的前后都没有相邻的空闲分区，则新增空闲分区表项。
   

动态分区分配又称为可变分区分配。这种分配方式不会预先划分内存分区，而是在进程装入内存时，根据进程的大小动态地建立分区，并使分区的大小正好适合进程的需要。因此系统分区的大小和数目是可变的。

动态分区分配没有内部碎片，但是有外部碎片。

**外部碎片，是指内存中的某些空闲分区由于太小而难以利用。如下图的蓝色部分**

![QQ截图20220602133026](/assets/blog_res/2022-06-02-OS24.assets/QQ%E6%88%AA%E5%9B%BE20220602133026.png)

如果内存中空闲空间的总和本来可以满足某进程的要求，但由于进程需要的是一整块连续的内存空间，因此这些“碎片”不能满足进程的需求。可以通过紧凑（拼凑，Compaction）技术来解决外部碎片。
